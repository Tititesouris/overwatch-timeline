"use strict";var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Timeline=function(){function e(){_classCallCheck(this,e);this.container=document.querySelector(".timeline__container");this.timelineIndicator=document.querySelector(".timeline__indicator");this.markers=document.querySelectorAll(".timeline__marker:not(.timeline__marker--ignore)");this.minimap=document.querySelector(".timeline__minimap");this.minimapIndicator=document.querySelector(".timeline__minimap__indicator");this.minimapMarkerContainer=document.querySelector(".timeline__minimap__markers");this.onScroll=this.onScroll.bind(this);this.handleMarkerClick=this.handleMarkerClick.bind(this);this.handleMinimapClick=this.handleMinimapClick.bind(this);this.onKeyDown=this.onKeyDown.bind(this);this.update=this.update.bind(this);this.minimapWidth=this.minimap.offsetWidth;this.minimapCurrentX=0;this.markerPositions=this.getMarkerPositions();this.markersLength=this.markerPositions.length;this.onMark=false;this.markerWidth=this.markers[0].offsetWidth;this.lastMarker=this.markerPositions[this.markersLength-1];this.targetX=0;this.currentX=0;this.scrollPercent=0;this.maxX=this.lastMarker;this.minX=0;this.bastionSequence="38384040373937396665";this.enteredSequence="";this.sequenceTimer;this.createMinimapMarkers();this.addEventListeners();requestAnimationFrame(this.update)}_createClass(e,[{key:"addEventListeners",value:function t(){document.addEventListener("wheel",this.onScroll);document.addEventListener("keydown",this.onKeyDown);this.container.addEventListener("click",this.handleMarkerClick);this.minimap.addEventListener("click",this.handleMinimapClick)}},{key:"getMarkerPositions",value:function i(){var e=[];[].forEach.call(this.markers,function(t){var i=t.offsetWidth/2;var r=t.offsetLeft;var n=r+i;e.push(n)});return e}},{key:"handleMarkerClick",value:function r(e){if(!e.target.classList.contains("marker__icon")){return}var t=e.target.closest(".timeline__item");if(t){this.setTarget(t.offsetLeft+t.offsetWidth/2);return}}},{key:"handleMinimapClick",value:function n(e){var t=e.pageX;var i=this.minimap.getBoundingClientRect().left;var r=t-i;var n=r*100/this.minimapWidth;var a=n*this.maxX/100;this.setTarget(a)}},{key:"onKeyDown",value:function a(e){this.bastion(e);if(e.keyCode===39){this.goToNextMaker();e.preventDefault()}else if(e.keyCode===37){this.goToPreviousMaker();e.preventDefault()}}},{key:"wheelDistance",value:function s(e){if(!e)e=event;var t=e.wheelDelta,i=e.detail;if(i){if(t)return t/i/40*i>0?1:-1;else return-i/3}else return t/120}},{key:"wheelDirection",value:function h(e){if(!e)e=event;return e.detail<0?1:e.wheelDelta>0?1:-1}},{key:"onScroll",value:function o(e){e.preventDefault();var t=-this.wheelDistance(e);var i=this.wheelDirection(e);if(this.targetX<this.minX){this.targetX=this.minX;return}if(this.targetX>this.maxX){this.targetX=this.maxX;return}this.targetX+=Math.floor(t*10);this.scrollPercent=Math.floor(this.targetX*100/this.maxX)}},{key:"update",value:function l(){requestAnimationFrame(this.update);this.updateTimeline();this.updateMinimap();this.checkIfAnyMarkersWereHit()}},{key:"checkIfAnyMarkersWereHit",value:function m(){for(var e=0;e<this.markersLength;e++){var t=this.markerPositions[e];var i=t-this.markerWidth/2;var r=t+this.markerWidth/2;if(!this.onMark&&this.targetX>=i&&this.targetX<=r){this.onMark=t;this.timelineIndicator.classList.remove("timeline__indicator--onMark");this.markers[e].classList.add("timeline__marker--hit");this.markers[e].classList.add("timeline__marker--wasHit")}if(this.onMark!==false&&this.onMark==t&&(this.targetX<i||this.targetX>r)){this.timelineIndicator.classList.remove("timeline__indicator--onMark");this.markers[e].classList.remove("timeline__marker--hit");this.onMark=false}}}},{key:"createMinimapMarkers",value:function c(){for(var e=0;e<this.markersLength;e++){var t=this.markerPositions[e]*100/this.maxX;var i=t*this.minimapWidth/100;this.minimapMarkerContainer.innerHTML+='<div class="timeline__minimap__marker"\n                style="transform: translateX('+(i-1)+'px)"></div>'}}},{key:"updateMinimap",value:function u(){var e=this.scrollPercent*this.minimapWidth/100;if(e<0)e=0;if(e>this.minimapWidth)e=this.minimapWidth;this.minimapCurrentX+=(e-this.minimapCurrentX)/6;this.minimapIndicator.style.transform="translateX("+this.minimapCurrentX+"px)"}},{key:"updateTimeline",value:function f(){this.currentX+=(this.targetX-this.currentX)/6;if(this.currentX<=this.minX){this.currentX=this.minX;this.container.style.transform="translateX("+-this.minX+"px)"}else if(this.currentX>=this.maxX){this.currentX=this.maxX;this.container.style.transform="translateX("+-this.maxX+"px)"}else{this.container.style.transform="translateX("+-this.currentX+"px)"}}},{key:"goToNextMaker",value:function d(){var e=false;for(var t=0;t<this.markersLength;t++){var i=this.markerPositions[t];if(i>Math.ceil(this.targetX)){e=i;break}}if(!e){return}this.setTarget(e)}},{key:"goToPreviousMaker",value:function k(){var e=false;for(var t=0;t<this.markersLength;t++){var i=this.markerPositions[t];if(i<Math.ceil(this.targetX)){e=i}}if(!e){this.setTarget(0);return}this.setTarget(e)}},{key:"setTarget",value:function v(e){this.targetX=Math.floor(e);this.scrollPercent=Math.floor(e*100/this.maxX)}},{key:"bastion",value:function p(e){var t=this;this.enteredSequence+=e.keyCode;if(this.enteredSequence.indexOf("38")>-1&&this.bastionSequence.indexOf(e.keyCode+"")>-1){window.clearTimeout(this.sequenceTimer);this.sequenceTimer=window.setTimeout(function(e){t.enteredSequence="";t.sequenceTimer=null},2e3)}if(this.enteredSequence.match(this.bastionSequence)){window.clearTimeout(this.sequenceTimer);this.setTarget(this.maxX);document.querySelector(".timeline__end").classList.add("show");this.enteredSequence=""}}}]);return e}();window.addEventListener("load",function(e){new Timeline});